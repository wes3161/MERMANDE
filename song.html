<!DOCTYPE html>
<html>
	<head>
		<title>LARGE CASH ENTERTAINMENT</title>
		<link rel="shortcut icon" href="photos/site/favicon.png" />
		<link rel="stylesheet" href="styles.css" />
		<style type="text/css">
      		BODY {overflow-x: hidden;}
   		</style>
		<script type = "text/javascript">
         window.onload = WebSocketTest
         
         function WebSocketTest() {
            if ("WebSocket" in window) {               
               // Let us open a web socket
               var ws = new WebSocket("ws://no-cf-dns-update.wesle.net:1234");
               ws.onopen = function (evt) { 
                  var msg = evt.data;
                  document.getElementById('DynamicContent').innerHTML = '<div id="prevBtn" class="gennew" onclick="livegen()">GENERATE NEW</div>';
               };
            }
         }
         
      </script>
	</head>
	<body>
		<script src="scripts/loader.js"></script>
		<script src="scripts/cursor.js"></script>
		<div id="mainHeader">
			<a href="/">
			<img src="photos/index/title.png" alt="LARGE CASH ENTERTAINMENT" id="headerImage" border="0" />
			</a>
		</div>
		<br>
		<div id="mainContent">
			<div class="indexContent">
                <div id="prevBtn" class="refresh" onclick="inject_snippet()">LOAD NEW</div>
                <div id="DynamicContent">
                </div>
                
				<h1 class="listTitle">TRUE CA$H SONGS</h1>
				 <div class='text-container'>
                        <!-- <p><b>A Ca$hFloe Song Generator Using GPT-2</b> <a href="url">learn more</a></p> -->
                        <div id="snippet-container"></div>
            <script>
            

            var totalTexts  = 2842;

            /* load random GPT-2-small text snippet: */
            function inject_snippet(id) {
                // rand text
                idText = Math.floor(Math.random() * totalTexts);
                
                let req = new XMLHttpRequest();
                req.addEventListener("load", (event) => {
                    document.querySelector("#snippet-container").innerHTML = req.responseText.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\n/g,"<br/>\n");
                });
                //req.open("GET", `//www.mermande.com/text-${idText}.txt`);
                req.open("GET", `//mermande.com/songs/song${idText}.txt`);
                req.send();
                console.log(`mermande.com/songs/song${idText}.txt`);
            }
            
            function livegen(id) {
            if ("WebSocket" in window) {               
               // Let us open a web socket
               var ws = new WebSocket("ws://no-cf-dns-update.wesle.net:1234");
               ws.onopen = function() {
                  // Web Socket is connected, send data using send()
                  ws.send("REQUEST_GEN_SONG");
               };
               ws.onmessage = function (evt) { 
                  var msg = evt.data.replace(/[^ -~]+/g, "").replace(/{#NL}/g, "\n");
                  console.log(msg)
                  if (msg === "END_OF_GENERATION") {
                        var msg = null;
                        websocket.onclose = function () {}; // disable onclose handler first
                        websocket.close();
                    }
                  document.querySelector("#snippet-container").innerHTML = msg.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\n/g,"<br/>\n");
                  // Style changes
                  //var formated = str.replace(this|hi, newSubstr|function)
                  //document.write(formated);
                  
               };
            } else {
            document.write("an error has occurred");
            }
            }
		    
		    inject_snippet();
		    
		    //function truegen(id) {
		    //}
        </script>
				<br>
			</div>
		</div>
	</body>
</html>
